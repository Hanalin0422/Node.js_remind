<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" type="text/css" href="/main.css">
</head>
</head>
<body class="grey-bg">
    <!-- <%= JSON.stringify(ê¸€ëª©ë¡) %> -->

    <%- include('nav.ejs') %>

    <button onclick="location.href='/write'">ê¸€ ì‘ì„±í•˜ëŸ¬ ê°€ê¸°</button>
    <div class="bbb">
        <input type="text" class="search">
        <button class="search-send">ê²€ìƒ‰</button>
    </div>

    <script>
        document.querySelector('.search-send').addEventListener('click', function(){
            let ì…ë ¥í•œê±° = document.querySelector('.search').value;
            location.href='/search?val=' + ì…ë ¥í•œê±°;
        })
    </script>

    
    <div class="white-bg">
        <% for(let i=ê¸€ëª©ë¡.length-1; i >=0 ; i--){ %>
            <div class="list-box">
                <a href="/detail/<%= ê¸€ëª©ë¡[i]._id %>">
                    <h4><%= ê¸€ëª©ë¡[i].title %></h4>
                </a>
                <p><%= ê¸€ëª©ë¡[i].content %></p>
                <p><%= ì‹œê°„ %></p>
                <span class="delete" data-id="<%= ê¸€ëª©ë¡[i]._id %>">ğŸ—‘ï¸</span>
            </div>
        <% } %>
            
        
    </div>
    <script>
        for(let i=0; i< '<%= ê¸€ëª©ë¡.length %>'; i++){
            document.querySelectorAll('.delete')[i]
            .addEventListener('click', function(e){
                fetch('/list/delete?docid=' + e.target.dataset.id, {
                    method : 'DELETE'
                })
                .then((r)=>r.text()) // ì„œë²„ê°€ ë³´ë‚´ëŠ”ê²Œ textì´ë©´ ì´ë ‡ê²Œ. objectë‚˜ arrayì¼ ê²½ìš° .json()
                .then((r)=>{
                    console.log(r.deletedCount)// rì€ ì„œë²„ê°€ ë³´ë‚¸ ë°ì´í„°ì„.
                    if(r.deletedCount !== undefined){
                        e.target.parentElement.style.display = 'none' // ë¶€ëª¨ html ê°€ì ¸ì˜´
                    }
                }) 
            })
        }
    </script>
</body>
</html>

<!-- document.querySelectorAll('.delete')[0].addEventListener('click', function(){
            fetch('/url~~', {
                method : 'DELETE',
                headers  :{
                    'Content-Type' : 'application/json'
                },
                body : 'ë°ì´í„°' JSON.stringify({a : 1})
            })
        }) -->

